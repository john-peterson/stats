

//////////////////////////////////////////////////////////////////////////////////
// File Description
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
/*
Course: 4104 - Assignment 1
This file was tested to work with no errors on Stata/SE 10.0 for Windows on 2008-02-11
This file will produce:
	1. Alpha, betas, t values, error covariance matrix (and the inverted matrix) for the one factor and three factor
	regressions for three time periods 1927-07 to 2007-08, 1927-07 to 1967-01, 1967-02 to 2007-08.
	2. The question 3 Fama-MacBeth regressions.
*/
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// Settings
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
// Change working directory
*cd ""

// Turn off more
set more off

// Clear the Results window
display _newline(`=c(pagesize)')
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// Initiate logging
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
// Close any previous log file
/* log close */

log using a1.log, replace // start logging
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 1a) Average excess returns and standard deviations
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
// Load data
insheet using data/whole.csv, delimiter(";") clear
// Show descriptive statistics
summ p11-p55 rm, detail
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 1b) The CAPM regressions
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯

mvreg p11-p55 = rm

//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 1c) The residuals covariance matrix and its inverse
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
quietly mvreg p11-p55 = rm

matrix list e(Sigma), nohalf
// Make inverted matrix
matrix invm = inv(e(Sigma))
matrix list invm, nohalf
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 1d) The residuals covariance matrix and its inverse for the first and second part
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
insheet using data/first.csv, delimiter(";") clear

quietly mvreg p11-p55 = rm

matrix list e(Sigma), nohalf
matrix invm = inv(e(Sigma))
matrix list invm, nohalf

insheet using data/second.csv, delimiter(";") clear

quietly mvreg p11-p55 = rm

matrix list e(Sigma), nohalf
matrix invm = inv(e(Sigma))
matrix list invm, nohalf
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////
// Question 2
//////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////////
// 2b) The three factor (rm, smb, hml) regressions
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
mvreg p11-p55 = rm smb hml
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 2c) The residuals covariance matrix and its inverse
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
quietly mvreg p11-p55 = rm smb hml

matrix list e(Sigma), nohalf
//////////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////////
// 2d) The residuals covariance matrix and its inverse for the first and second part
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
insheet using data/first.csv, delimiter(";") clear

quietly mvreg p11-p55 = rm smb hml

matrix list e(Sigma), nohalf
matrix invm = inv(e(Sigma))
matrix list invm, nohalf

insheet using data/second.csv, delimiter(";") clear

quietly mvreg p11-p55 = rm smb hml

matrix list e(Sigma), nohalf
matrix invm = inv(e(Sigma))
matrix list invm, nohalf
//////////////////////////////////////////////////////////////////////////////////



//////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////
// Question 3
//////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 3a) The first step CAPM betas and the second step betas
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯
insheet using data/industryreturns.csv, delimiter(";") clear

mvreg nodur durbl manuf enrgy hitec telcm shops hlth utils other = zm

insheet using data/q3a.csv, delimiter(";") clear

forval i=1(1)974 {
	reg ret`i' beta size`i', noheader
}

halt
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// 3d) The first step multiple regression betas and the second step betas
// ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯

insheet using data/sizereturns.csv, delimiter(";") clear

mvreg lo10 dec2-dec9 hi10 = cpius cbondtbond

insheet using data/q3d.csv, delimiter(";") clear

forval i=1(1)782 {
	reg ret`i' bcpi bcbtb, noheader
}
//////////////////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////////////////
// Close log
*log close;
//////////////////////////////////////////////////////////////////////////////////